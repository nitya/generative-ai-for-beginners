
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Multi-part curriculum teaching Generative AI from concepts to code">
      
      
        <meta name="author" content="AI Advocacy">
      
      
        <link rel="canonical" href="https://nitya.github.io/generative-ai-for-beginners/15-rag-and-vector-databases/">
      
      
        <link rel="prev" href="../14-the-generative-ai-application-lifecycle/">
      
      
        <link rel="next" href="../16-open-source-models/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.45">
    
    
      
        <title>15. RAG and Vector Databases - Generative AI For Beginners</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#retrieval-augmented-generation-rag-and-vector-databases" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Generative AI For Beginners" class="md-header__button md-logo" aria-label="Generative AI For Beginners" data-md-component="logo">
      
  <img src="../img/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Generative AI For Beginners
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              15. RAG and Vector Databases
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 2c-1.82 0-3.53.5-5 1.35C8 5.08 10 8.3 10 12s-2 6.92-5 8.65C6.47 21.5 8.18 22 10 22a10 10 0 0 0 10-10A10 10 0 0 0 10 2"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="cyan"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/generative-ai-for-beginners" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/generative-ai-for-beginners
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../00-course-setup/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../01-introduction-to-genai/" class="md-tabs__link">
          
  
  Lessons

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Generative AI For Beginners" class="md-nav__button md-logo" aria-label="Generative AI For Beginners" data-md-component="logo">
      
  <img src="../img/logo.svg" alt="logo">

    </a>
    Generative AI For Beginners
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/generative-ai-for-beginners" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/generative-ai-for-beginners
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-course-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-course-setup/SETUP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Lessons
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Lessons
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-introduction-to-genai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-exploring-and-comparing-different-llms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Compare LLMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-using-generative-ai-responsibly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Responsible AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-prompt-engineering-fundamentals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Prompt Engineering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-advanced-prompts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Advanced Prompts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-text-generation-apps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Text Generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-building-chat-applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Chat Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-building-search-applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Search Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-building-image-applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. Image Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-building-low-code-ai-applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. Low Code Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Integrating with11-integrating-with-function-calling/README.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11. Function Calling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-designing-ux-for-ai-applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12. Designing UX for AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-securing-ai-applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13. Securing AI Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-the-generative-ai-application-lifecycle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14. Generative AI App Lifecycle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    15. RAG and Vector Databases
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    15. RAG and Vector Databases
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-goals" class="md-nav__link">
    <span class="md-ellipsis">
      Learning Goals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#our-scenario-enhancing-our-llms-with-our-own-data" class="md-nav__link">
    <span class="md-ellipsis">
      Our Scenario: enhancing our LLMs with our own data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieval-augmented-generation-rag" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieval Augmented Generation (RAG)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retrieval Augmented Generation (RAG)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-rags-retrieval-augmented-generation-work" class="md-nav__link">
    <span class="md-ellipsis">
      How RAGs (Retrieval Augmented Generation) work
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-would-you-use-rags" class="md-nav__link">
    <span class="md-ellipsis">
      Why would you use RAGs?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-knowledge-base" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a knowledge base
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a knowledge base">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vector-databases" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Databases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-text-to-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      From text to embeddings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieval-and-vector-search" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieval and Vector Search
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retrieval and Vector Search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vector-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Similarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-index" class="md-nav__link">
    <span class="md-ellipsis">
      Search index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#re-ranking" class="md-nav__link">
    <span class="md-ellipsis">
      Re-ranking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bringing-it-all-together" class="md-nav__link">
    <span class="md-ellipsis">
      Bringing it all together
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating-our-application" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluating our application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evaluating our application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluation-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluation Metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases-for-using-rag-retervival-augmented-generation-and-vector-databases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases for using RAG (Retervival Augmented Generation) and vector databases
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Assignment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-does-not-stop-here-continue-the-journey" class="md-nav__link">
    <span class="md-ellipsis">
      Learning does not stop here, continue the Journey
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../16-open-source-models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    16. Open Source Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-ai-agents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17. AI Agents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../18-fine-tuning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18. Fine Tuning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-slm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    19. Small Language Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-mistral/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    20. Mistral
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../21-meta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21. Meta
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-goals" class="md-nav__link">
    <span class="md-ellipsis">
      Learning Goals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#our-scenario-enhancing-our-llms-with-our-own-data" class="md-nav__link">
    <span class="md-ellipsis">
      Our Scenario: enhancing our LLMs with our own data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieval-augmented-generation-rag" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieval Augmented Generation (RAG)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retrieval Augmented Generation (RAG)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-rags-retrieval-augmented-generation-work" class="md-nav__link">
    <span class="md-ellipsis">
      How RAGs (Retrieval Augmented Generation) work
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-would-you-use-rags" class="md-nav__link">
    <span class="md-ellipsis">
      Why would you use RAGs?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-knowledge-base" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a knowledge base
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a knowledge base">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vector-databases" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Databases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-text-to-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      From text to embeddings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieval-and-vector-search" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieval and Vector Search
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retrieval and Vector Search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vector-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Similarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-index" class="md-nav__link">
    <span class="md-ellipsis">
      Search index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#re-ranking" class="md-nav__link">
    <span class="md-ellipsis">
      Re-ranking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bringing-it-all-together" class="md-nav__link">
    <span class="md-ellipsis">
      Bringing it all together
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating-our-application" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluating our application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evaluating our application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluation-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluation Metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases-for-using-rag-retervival-augmented-generation-and-vector-databases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases for using RAG (Retervival Augmented Generation) and vector databases
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Assignment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-does-not-stop-here-continue-the-journey" class="md-nav__link">
    <span class="md-ellipsis">
      Learning does not stop here, continue the Journey
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="retrieval-augmented-generation-rag-and-vector-databases">Retrieval Augmented Generation (RAG) and Vector Databases<a class="headerlink" href="#retrieval-augmented-generation-rag-and-vector-databases" title="Permanent link">&para;</a></h1>
<p><a href="https://aka.ms/gen-ai-lesson15-gh?WT.mc_id=academic-105485-koreyst"><img alt="Retrieval Augmented Generation (RAG) and Vector Databases" src="images/15-lesson-banner.png?WT.mc_id=academic-105485-koreyst" /></a></p>
<p>In the search applications lesson, we briefly learned how to integrate your own data into Large Language Models (LLMs). In this lesson, we will delve further into the concepts of grounding your data in your LLM application, the mechanics of the process and the methods for storing data, including both embeddings and text.</p>
<blockquote>
<p><strong>Video Coming Soon</strong></p>
</blockquote>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>In this lesson we will cover the following:</p>
<ul>
<li>
<p>An introduction to RAG, what it is and why it is used in AI (artificial intelligence).</p>
</li>
<li>
<p>Understanding what vector databases are and creating one for our application.</p>
</li>
<li>
<p>A practical example on how to integrate RAG into an application.</p>
</li>
</ul>
<h2 id="learning-goals">Learning Goals<a class="headerlink" href="#learning-goals" title="Permanent link">&para;</a></h2>
<p>After completing this lesson, you will be able to:</p>
<ul>
<li>
<p>Explain the significance of RAG in data retrieval and processing.</p>
</li>
<li>
<p>Setup RAG application and ground your data to an LLM</p>
</li>
<li>
<p>Effective integration of RAG and Vector Databases in LLM Applications.</p>
</li>
</ul>
<h2 id="our-scenario-enhancing-our-llms-with-our-own-data">Our Scenario: enhancing our LLMs with our own data<a class="headerlink" href="#our-scenario-enhancing-our-llms-with-our-own-data" title="Permanent link">&para;</a></h2>
<p>For this lesson, we want to add our own notes into the education startup, which allows the chatbot to get more information on the different subjects. Using the notes that we have, learners will be able to study better and understand the different topics, making it easier to revise for their examinations. To create our scenario, we will use:</p>
<ul>
<li>
<p><code>Azure OpenAI:</code> the LLM we will use to create our chatbot</p>
</li>
<li>
<p><code>AI for beginners' lesson on Neural Networks</code>: this will be the data we ground our LLM on</p>
</li>
<li>
<p><code>Azure AI Search</code> and <code>Azure Cosmos DB:</code> vector database to store our data and create a search index</p>
</li>
</ul>
<p>Users will be able to create practice quizzes from their notes, revision flash cards and summarize it to concise overviews. To get started, let us look at what is RAG and how works:</p>
<h2 id="retrieval-augmented-generation-rag">Retrieval Augmented Generation (RAG)<a class="headerlink" href="#retrieval-augmented-generation-rag" title="Permanent link">&para;</a></h2>
<p>An LLM powered chatbot processes user prompts to generate responses. It is designed to be interactive and engages with users on a wide array of topics. However, its responses are limited to the context provided and its foundational training data. For instance, GPT-4 knowledge cutoff is September 2021, meaning, it lacks knowledge of events that have occurred after this period. In addition, the data used to train LLMs excludes confidential information such as personal notes or a company's product manual.</p>
<h3 id="how-rags-retrieval-augmented-generation-work">How RAGs (Retrieval Augmented Generation) work<a class="headerlink" href="#how-rags-retrieval-augmented-generation-work" title="Permanent link">&para;</a></h3>
<p><img alt="drawing showing how RAGs work" src="images/how-rag-works.png?WT.mc_id=academic-105485-koreyst" /></p>
<p>Suppose you want to deploy a chatbot that creates quizzes from your notes, you will require a connection to the knowledge base. This is where RAG comes to the rescue. RAGs operate as follows:</p>
<ul>
<li>
<p><strong>Knowledge base:</strong> Before retrieval, these documents need to be ingested and preprocessed, typically breaking down large documents into smaller chunks, transforming them to text embedding and storing them in a database.</p>
</li>
<li>
<p><strong>User Query:</strong> the user asks a question</p>
</li>
<li>
<p><strong>Retrieval:</strong> When a user asks a question, the embedding model retrieves relevant information from our knowledge base to provide more context that will be incorporated into the prompt.</p>
</li>
<li>
<p><strong>Augmented Generation:</strong> the LLM enhances its response based on the data retrieved. It allows the response generated to be not only based on pre-trained data but also relevant information from the added context. The retrieved data is used to augment the LLM's responses. The LLM then returns an answer to the user's question.</p>
</li>
</ul>
<p><img alt="drawing showing how RAGs architecture" src="images/encoder-decode.png?WT.mc_id=academic-105485-koreyst" /></p>
<p>The architecture for RAGs is implemented using transformers consisting of two parts: an encoder and a decoder. For example, when a user asks a question, the input text 'encoded' into vectors capturing the meaning of words and the vectors are 'decoded' into our document index and generates new text based on the user query. The LLM uses both an encoder-decoder model to generate the output.</p>
<p>Two approaches when implementing RAG according to the proposed paper: <a href="https://arxiv.org/pdf/2005.11401.pdf?WT.mc_id=academic-105485-koreyst">Retrieval-Augmented Generation for Knowledge intensive NLP (natural language processing software) Tasks</a> are:</p>
<ul>
<li>
<p><strong><em>RAG-Sequence</em></strong> using retrieved documents to predict the best possible answer to a user query</p>
</li>
<li>
<p><strong>RAG-Token</strong> using documents to generate the next token, then retrieve them to answer the user's query</p>
</li>
</ul>
<h3 id="why-would-you-use-rags">Why would you use RAGs?<a class="headerlink" href="#why-would-you-use-rags" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Information richness:</strong> ensures text responses are up to date and current. It, therefore, enhances performance on domain specific tasks by accessing the internal knowledge base.</p>
</li>
<li>
<p>Reduces fabrication by utilizing <strong>verifiable data</strong> in the knowledge base to provide context to the user queries.</p>
</li>
<li>
<p>It is <strong>cost effective</strong> as they are more economical compared to fine-tuning an LLM</p>
</li>
</ul>
<h2 id="creating-a-knowledge-base">Creating a knowledge base<a class="headerlink" href="#creating-a-knowledge-base" title="Permanent link">&para;</a></h2>
<p>Our application is based on our personal data i.e., the Neural Network lesson on AI For Beginners curriculum.</p>
<h3 id="vector-databases">Vector Databases<a class="headerlink" href="#vector-databases" title="Permanent link">&para;</a></h3>
<p>A vector database, unlike traditional databases, is a specialized database designed to store, manage and search embedded vectors. It stores numerical representations of documents. Breaking down data to numerical embeddings makes it easier for our AI system to understand and process the data.</p>
<p>We store our embeddings in vector databases as LLMs have a limit of the number of tokens they accept as input. As you cannot pass the entire embeddings to an LLM, we will need to break them down into chunks and when a user asks a question, the embeddings most like the question will be returned together with the prompt. Chunking also reduces costs on the number of tokens passed through an LLM.</p>
<p>Some popular vector databases include Azure Cosmos DB, Clarifyai, Pinecone, Chromadb, ScaNN, Qdrant and DeepLake. You can create an Azure Cosmos DB model using Azure CLI with the following command:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>az<span class="w"> </span>login
az<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>&lt;resource-group-name&gt;<span class="w"> </span>-l<span class="w"> </span>&lt;location&gt;
az<span class="w"> </span>cosmosdb<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>&lt;cosmos-db-name&gt;<span class="w"> </span>-r<span class="w"> </span>&lt;resource-group-name&gt;
az<span class="w"> </span>cosmosdb<span class="w"> </span>list-keys<span class="w"> </span>-n<span class="w"> </span>&lt;cosmos-db-name&gt;<span class="w"> </span>-g<span class="w"> </span>&lt;resource-group-name&gt;
</code></pre></div></td></tr></table></div>
<h3 id="from-text-to-embeddings">From text to embeddings<a class="headerlink" href="#from-text-to-embeddings" title="Permanent link">&para;</a></h3>
<p>Before we store our data, we will need to convert it to vector embeddings before it is stored in the database. If you are working with large documents or long texts, you can chunk them based on queries you expect. Chunking can be done at sentence level, or at a paragraph level. As chunking derives meanings from the words around them, you can add some other context to a chunk, for example, by adding the document title or including some text before or after the chunk. You can chunk the data as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">max_length</span><span class="p">,</span> <span class="n">min_length</span><span class="p">):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_chunk</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">current_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">max_length</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">min_length</span><span class="p">:</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">))</span>
            <span class="n">current_chunk</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># If the last chunk didn&#39;t reach the minimum length, add it anyway</span>
    <span class="k">if</span> <span class="n">current_chunk</span><span class="p">:</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div></td></tr></table></div>
<p>Once chunked, we can then embed our text using different embedding models. Some models you can use include: word2vec, ada-002 by OpenAI, Azure Computer Vision and many more. Selecting a model to use will depend on the languages you're using, the type of content encoded (text/images/audio), the size of input it can encode and length of the embedding output.</p>
<p>An example of embedded text using OpenAI's <code>text-embedding-ada-002</code> model is:
<img alt="an embedding of the word cat" src="images/cat.png?WT.mc_id=academic-105485-koreyst" /></p>
<h2 id="retrieval-and-vector-search">Retrieval and Vector Search<a class="headerlink" href="#retrieval-and-vector-search" title="Permanent link">&para;</a></h2>
<p>When a user asks a question, the retriever transforms it into a vector using the query encoder, it then searches through our document search index for relevant vectors in the document that are related to the input. Once done, it converts both the input vector and document vectors into text and passes it through the LLM.</p>
<h3 id="retrieval">Retrieval<a class="headerlink" href="#retrieval" title="Permanent link">&para;</a></h3>
<p>Retrieval happens when the system tries to quickly find the documents from the index that satisfy the search criteria. The goal of the retriever is to get documents that will be used to provide context and ground the LLM on your data.</p>
<p>There are several ways to perform search within our database such as:</p>
<ul>
<li>
<p><strong>Keyword search</strong> - used for text searches</p>
</li>
<li>
<p><strong>Semantic search</strong> - uses the semantic meaning of words</p>
</li>
<li>
<p><strong>Vector search</strong> - converts documents from text to vector representations using embedding models. Retrieval will be done by querying the documents whose vector representations are closest to the user question.</p>
</li>
<li>
<p><strong>Hybrid</strong> - a combination of both keyword and vector search.</p>
</li>
</ul>
<p>A challenge with retrieval comes in when there is no similar response to the query in the database, the system will then return the best information they can get, however, you can use tactics like set up the maximum distance for relevance or use hybrid search that combines both keywords and vector search. In this lesson we will use hybrid search, a combination of both vector and keyword search. We will store our data into a dataframe with columns containing the chunks as well as embeddings.</p>
<h3 id="vector-similarity">Vector Similarity<a class="headerlink" href="#vector-similarity" title="Permanent link">&para;</a></h3>
<p>The retriever will search through the knowledge database for embeddings that are close together, the closest neighbour, as they are texts that are similar. In the scenario a user asks a query, it is first embedded then matched with similar embeddings. The common measurement that is used to find how similar different vectors are is cosine similarity which is based on the angle between two vectors.</p>
<p>We can measure similarity using other alternatives we can use are Euclidean distance which is the straight line between vector endpoints and dot product which measures the sum of the products of corresponding elements of two vectors.</p>
<h3 id="search-index">Search index<a class="headerlink" href="#search-index" title="Permanent link">&para;</a></h3>
<p>When doing retrieval, we will need to build a search index for our knowledge base before we perform search. An index will store our embeddings and can quickly retrieve the most similar chunks even in a large database. We can create our index locally using:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>

<span class="n">embeddings</span> <span class="o">=</span> <span class="n">flattened_df</span><span class="p">[</span><span class="s1">&#39;embeddings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

<span class="c1"># Create the search index</span>
<span class="n">nbrs</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;ball_tree&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># To query the index, you can use the kneighbors method</span>
<span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nbrs</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="re-ranking">Re-ranking<a class="headerlink" href="#re-ranking" title="Permanent link">&para;</a></h3>
<p>Once you have queried the database, you might need to sort the results from the most relevant. A reranking LLM utilizes Machine Learning to improve the relevance of search results by ordering them from the most relevant. Using Azure AI Search, reranking is done automatically for you using a semantic reranker. An example of how reranking works using nearest neighbours:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Find the most similar documents</span>
<span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nbrs</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">([</span><span class="n">query_vector</span><span class="p">])</span>

<span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Print the most similar documents</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">flattened_df</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">flattened_df</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">flattened_df</span><span class="p">[</span><span class="s1">&#39;distances&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> not found in DataFrame&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="bringing-it-all-together">Bringing it all together<a class="headerlink" href="#bringing-it-all-together" title="Permanent link">&para;</a></h2>
<p>The last step is adding our LLM into the mix to be able to get responses that are grounded on our data. We can implement it as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">user_input</span> <span class="o">=</span> <span class="s2">&quot;what is a perceptron?&quot;</span>

<span class="k">def</span> <span class="nf">chatbot</span><span class="p">(</span><span class="n">user_input</span><span class="p">):</span>
    <span class="c1"># Convert the question to a query vector</span>
    <span class="n">query_vector</span> <span class="o">=</span> <span class="n">create_embeddings</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>

    <span class="c1"># Find the most similar documents</span>
    <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nbrs</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">([</span><span class="n">query_vector</span><span class="p">])</span>

    <span class="c1"># add documents to query  to provide context</span>
    <span class="n">history</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flattened_df</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

    <span class="c1"># combine the history and the user input</span>
    <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>

    <span class="c1"># create a message object</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are an AI assistant that helps with AI questions.&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>
    <span class="p">]</span>

    <span class="c1"># use chat completion to generate a response</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">openai</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">max_tokens</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">messages</span><span class="o">=</span><span class="n">messages</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span>

<span class="n">chatbot</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="evaluating-our-application">Evaluating our application<a class="headerlink" href="#evaluating-our-application" title="Permanent link">&para;</a></h2>
<h3 id="evaluation-metrics">Evaluation Metrics<a class="headerlink" href="#evaluation-metrics" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Quality of responses supplied ensuring it sounds natural, fluent and human-like</p>
</li>
<li>
<p>Groundedness of the data: evaluating whether the response that came from supplied docs</p>
</li>
<li>
<p>Relevance: evaluating the response matches and is related to the question asked</p>
</li>
<li>
<p>Fluency - whether the response makes sense grammatically</p>
</li>
</ul>
<h2 id="use-cases-for-using-rag-retervival-augmented-generation-and-vector-databases">Use Cases for using RAG (Retervival Augmented Generation) and vector databases<a class="headerlink" href="#use-cases-for-using-rag-retervival-augmented-generation-and-vector-databases" title="Permanent link">&para;</a></h2>
<p>There are many different use cases where function calls can improve your app like:</p>
<ul>
<li>
<p>Question and Answering: grounding your company data to a chat that can be used by employees to ask questions.</p>
</li>
<li>
<p>Recommendation Systems: where you can create a system that matches the most similar values e.g. movies, restaurants and many more.</p>
</li>
<li>
<p>Chatbot services: you can store chat history and personalize the conversation based on the user data.</p>
</li>
<li>
<p>Image search based on vector embeddings, useful when doing image recognition and anomaly detection.</p>
</li>
</ul>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>We have covered the fundamental areas of RAG from adding our data to the application, the user query and output. To simplify creation of RAG, you can use frameworks such as Semanti Kernel, Langchain or Autogen.</p>
<h2 id="assignment">Assignment<a class="headerlink" href="#assignment" title="Permanent link">&para;</a></h2>
<p>To continue your learning of Retrieval Augmented Generation (RAG) you can build:</p>
<ul>
<li>
<p>Build a front-end for the application using the framework of your choice</p>
</li>
<li>
<p>Utilize a framework, either LangChain or Semantic Kernel, and recreate your application.</p>
</li>
</ul>
<p>Congratulations for completing the lesson 👏.</p>
<h2 id="learning-does-not-stop-here-continue-the-journey">Learning does not stop here, continue the Journey<a class="headerlink" href="#learning-does-not-stop-here-continue-the-journey" title="Permanent link">&para;</a></h2>
<p>After completing this lesson, check out our <a href="https://aka.ms/genai-collection?WT.mc_id=academic-105485-koreyst">Generative AI Learning collection</a> to continue leveling up your Generative AI knowledge!</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../14-the-generative-ai-application-lifecycle/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 14. Generative AI App Lifecycle">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                14. Generative AI App Lifecycle
              </div>
            </div>
          </a>
        
        
          
          <a href="../16-open-source-models/" class="md-footer__link md-footer__link--next" aria-label="Next: 16. Open Source Models">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                16. Open Source Models
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - present Microsoft

    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.expand", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.path", "navigation.top", "toc.follow", "navigation.footer", "content.code.copy", "content.tabs.link"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>